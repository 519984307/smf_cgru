<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<link href="../../doc/styles.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="images/icon.png" type="image/png">
<title>Afanasy Job Block</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Timur Hairulin" />
<meta name="description" content="CGRU: Tools for Houdini, Nuke, Maya, Afanasy - free open source render farm manager" />
<meta name="keywords" content="Houdini, Maya, Nuke, RenderMan, Mantra, Mentalray, prman, Afanasy, animation, rendering, render, farm, manager, free, open source" />
</head>
<body>
<table width="99%" align="center">
<tr align="center">
<td width="33%">
<a href="http://sourceforge.net"><img src="../../doc/images/sflogo.png" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
</td>
<td width="33%">
<p><a href="../../index.html" target="_top"><img src="../../doc/images/cgru16.png" border="0" alt="CGRU" /></a></p>
</td>
<td width="33%">
<a href="http://cgtalk.ru"><img src="../../doc/images/cgtalkru.png" width="88" height="31" border="0" alt="CGTALK.RU Logo" /></a>
</td>
</tr>
</table>

<table width="90%" align="center" cellpadding="0" cellspacing="0">
<tr>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/header_left.png')" />
</td>
<td>
<div style="width:100%;height:40px;background:url('../../doc/images/header.png') repeat-x" />
</td>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/header_right.png')" />
</td>
</tr>
</table>
<!--HEADER-->
<h2 align="center">Afanasy Job Block</h2>
<hr />

<h3>Block Attributes:</h3>
<ul>
<li><a name="Name"/><b>Name</b> - Each Block has an unique name. If new Block added to Job which the name already exists, Job change it's name by adding a number. Blocks dependence bases on their names and depend masks to match it.</li>

<li><a name="TasksNum"/><b>Number of Tasks</b> - Number of tasks in block.</li>

<li><a name="Numeric"/><b>Numeric</b> - Whether the block is numeric or string.</li>

<li><a name="FrameFirst"/><b>Frame First</b> - First block frame.</li>

<li><a name="FrameLast"/><b>Frame Last</b> - Last block frame.</li>

<li><a name="FrameInc"/><b>Frames Increment</b> - Frames increment.<br/>

<li><a name="FramesPerTask"/><b>Frames Per Task</b> - Frames per task.
In numeric blocks used to compute command first and last frame, parser percentage.
When block has tasks with individual commands used to compute blocks per task dependency.
Negative values means sub-frame dependency. For example you can render tiles or generate shadows in one block
and generate mantra 'ifd' files in another with 1 frame per task.
And if task has 4 shadows or 2x2 tiles you can set -4 frames per task for depended block.
</li>
</ul>

Read <var>Command</var> description for details.

<h3>Block Editable Parameters:</h3>
<ul>
<li><a name="TasksName"/><b>Tasks Name</b> - Block tasks names pattern.<br/>
Block - numeric, pattern - not empty: generated task will fill this pattern with its first and last frames numbers<br/>
Block - numeric, pattern - empty: tasks will take <var>first_frame - last_frame</var> name.<br/>
Block - not numeric, patern - not empty: task fill this pettern with it name.<br/>
Block - not numeric, patern - not empty: task simply take its name.<br/>
</li>

<li><a name="TasksType"/><b>Tasks Type</b> - Block tasks service name.</li>

<li><a name="ParserType"/><b>Parser Type</b> - Block tasks output parser name.</li>

<li><a name="WorkingDirectory"/><b>Working Directory</b> - Tasks process working directory.</li>

<li><a name="CmdPre"/><b>Pre Command</b> - Command to execute when job comes to server.</li>

<li><a name="CmdPost"/><b>Post Command</b> - Command to execute when job deletes from server.<br/>
Note, that this commands are executed by server, and not from block working directory. Use absolute paths here or even transfer paths if you server has another file system than renders.<br/>
They are executed in a special thread with commands queue. This means if somebody executes 'sleep 1000', other commands execution will be delayed on 1000 seconds (only delayed, not lost).<br/></li>

<li><a name="Capacity"/><b>Capacity</b> - tasks capacity (task checks available capacity on render to run on it, and takes its capacity value). Capacity can be static (by default) and variable - base value and coefficients:<br/>
<b>Capacity Minimum Coefficient</b> - minimum Capacity multiplier.<br/>
<b>Capacity Maximum Coefficient</b> - maximum Capacity multiplier.<br/>
Block can generate tasks with capacity*coefficient to fit free render capacity. Task commands will be searched for the special string to replace it with capacity coefficient number. This command replacement performs render by service python class instance. Any service (tasks type) can describe own rule for this replacement by implementation of base class method. By default, base <kbd>service</kbd> class performs <code>command.replace( '@AF_CAPACITY@', str( capacity))</code>.<br/>
You can specify number of CPUs to use for your applications (if it supports it by command line arguments).
</li>

<li><a name="MultiHost"/>
<b>Multi Host Tasks</b> - block tasks can run on several hosts (prman <i>netrender</i>, houdini <i>mantra</i> remote rendering).<br/>
<b>Multi Hosts Minimum</b> - Minimum number of hosts task can run on.<br/>
<b>Multi Hosts Maximum</b> - Maximum number of hosts task can run on.<br/>
<b>Multi Hosts Maximum Wait Time</b> - Time in seconds to wait for maximum hosts.<br/>
<b>Multi Hosts Service</b> - Command to execute on slaves hosts, if it is empty, no service will be.<br/>
<b>Multi Hosts Service Wait Time</b> - Time in seconds to wait for master execution after slaves execution.<br/>
<b>Multi Hosts Same Host Master</b> - Master host will be in slaves list. For example if task took 'r00', 'r01', 'r02', 'r03', 'r04' hosts master command will be executed on 'r00' and 'r00' will be in slaves list too. If tasks can multihost service you can't enable this parameter, because only one command can be executed master or slave.<br/>
</li>

<li><a name="MaxHosts"/><b>Maximum Hosts</b> - maximum number of hosts block can run on.</li>

<li><a name="HostsMask"/><b>Hosts Mask</b> - Block run only on Renders which host name matches this mask.</li>

<li><a name="HostsMaskExclude"/><b>Exclude Hosts Mask</b> - Block can not run on renders which host name matches this mask.</li>

<li><a name="DependMask"/><b>Depend Mask</b> - Block will wait previous job blocks which name matches this mask.</li>

<li><a name="TasksDependMask"/><b>Tasks Depend Mask</b> - Block task will wait other job blocks task which name matches this mask.</li>

<li><a name="ErrorRetries"/><b>Error Retries</b> - Number of task errors to retry it automatically. Value '-1' means take this value from user settings.</li>

<li><a name="ErrorsAvoidHost"/><b>Errors Avoid Host</b> - Maximum number of errors on same host. Block begins to avoid render host name if number of errors on it greater or equal this value. Value less then '1' means no limit. Value '-1' means take this value from user settings.</li>

<li><a name="ErrorsTaskSameHost"/><b>Errors Task Same Host</b> - Maximum number of errors for task on same host. Task begin to avoid this host name of errors on it greater or equal this value. Value less then '1' means no limit. Value '-1' means take this value from user settings.</li>

<li><a name="TasksMaxRunTime"/><b>Tasks Maximum Run Time</b> - Tasks maximum time to run. After this time task will be set to error ( and may be automatically restarted according to <var>Error Retries</var> value). If this value equals zero, no task run time limit exists.
<br/><br/></li>

<li><a name="NeedPower"/><b>Need Power</b> - Minimum render host power needed. It's custom host parameter can be defined in farm description.</li>

<li><a name="NeedMemory"/><b>Need Memory</b> - Minimum render host free memory needed.</li>

<li><a name="NeedHDD"/><b>Need HDD</b> - Minimum render host free disk space needed.</li>

<li><a name="NeedProperties"/><b>Need Properties</b> - Mask to much render host properties to run on it. It's custom host parameter can be defined in farm description.
<br/><br/>
</li>

<li><a name="Command"/><b>Command</b> - Tasks command pattern. When block produces a task it calculates an unique command from this pattern and other parameters, depend on block type - numeric or string, replacing <kbd>%1</kbd>, <kbd>%2</kbd> and <kbd>%04d</kbd> strings using <a href="http://doc.trolltech.com/qstring.html"><code>QString::arg</code></a> and <a href="http://www.kernel.org/doc/man-pages/online/pages/man3/sprintf.3.html"><code>sprintf</code></a> functions:
<ul>
<li><p>String: block seek for "%1" string in command and replace it by another string get from <var>Task Command</var>.</p>
<p>Example:</p>
<p>
command = <kbd>myrender some.scene -camera %1</kbd><br />
arguments = <kbd>['sun','sky','front','side','bottom']</kbd><br />
Result:<br />
1st task command: <kbd>myrender some.scene -camera sun</kbd><br />
2nd task command: <kbd>myrender some.scene -camera sky</kbd><br />
3rd task command: <kbd>myrender some.scene -camera front</kbd><br />
...<br />
</p><p>
If block command is empty <var>Task Command</var> is simply used.
</p></li>
<li><p>Numeric: block calculates first and last frame for the task according to task number, <var>Frame First</var>, <var>Frame Last</var>, <var>Frame per Host</var> and <var>Frame Increment</var> values.</p>
<p>Examples:
</p><p>
command = <kbd>myrender some.scene -s %1 -e %2</kbd><br />
Frame First = <kbd>1</kbd><br />
Frame Last = <kbd>10</kbd><br />
Frame per Host = <kbd>4</kbd><br />
Result:<br />
1st task command: <kbd>myrender some.scene -s 1 -e 4</kbd><br />
2nd task command: <kbd>myrender some.scene -s 5 -e 8</kbd><br />
3rd task command: <kbd>myrender some.scene -s 9 -e 10</kbd><br />
</p><p>
command = <kbd>myrender something.%04d.rib</kbd><br />
Frame First = <kbd>1</kbd><br />
Frame Last = <kbd>10</kbd><br />
Frame per Host = <kbd>1</kbd><br />
Result:<br />
1st task command: <kbd>myrender something.0001.rib</kbd><br />
2nd task command: <kbd>myrender something.0002.rib</kbd><br />
...<br />
last task command: <kbd>myrender something.0010.rib</kbd><br />
</p><p>
You can check numbers placing by <code><a href="cmd.html">afcmd</a> num [command] [number1] [number2]</code> command.
</p>
</li>
</ul>
</li>
<li><p><a name="Files"/><b>Files</b> - File(s) pattern.
Each task can have result file(s) pattern.
Result file name will be constructed from this pattern by the same method as described before.
Some another application, for example watch GUI,
can execute your favorite image viewer <code>program [file]</code> and preview result frame.</p>
<p>Example (numeric):</p>
<p>
Block View Command = <kbd>images/back.%04d.exr</kbd><br />
Preview program = <kbd>kuickshow</kbd><br />
Result for 57 frame: <kbd>kuickshow images/back.0057.exr</kbd><br />
</p><p>
In Watch program will be executed in block working directory
</p>
<p>Example (not numeric):</p>
<p>
Block View Command = <kbd>images/back.%1.exr</kbd><br />
Task View Command = <kbd>0057</kbd><br />
Preview program = <kbd>kuickshow</kbd><br />
Result: <kbd>kuickshow images/back.0057.exr</kbd><br />
</p>
<p>
If block is not numeric and block view command is empty only task view command is used.
</p>
<p>
In Watch program will be executed in block working directory.
</p>
</li>
</ul>

<h3>Block State:</h3>
<ul>
<li><b><i> Ready                </i> <small><code> RDY </code></small></b> - Block is ready to produce a task.</li>
<li><b><i> Running              </i> <small><code> RUN </code></small></b> - Block has running tasks.</li>
<li><b><i> Done                 </i> <small><code> DON </code></small></b> - All block tasks are done (or some skipped).</li>
<li><b><i> Error                </i> <small><code> ERR </code></small></b> - Block has some error tasks.</li>
<li><b><i> Skipped              </i> <small><code> SKP </code></small></b> - Some block tasks are skipped.</li>
<li><b><i> Waiting Dependencies </i> <small><code> WD  </code></small></b> - Block waits some other blocks.</li>
</ul>

<!--FOOTER-->
<table width="90%" align="center" cellpadding="0" cellspacing="0">
<tr>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/footer_left.png')" />
</td>
<td>
<div style="width:100%;height:40px;background:url('../../doc/images/footer.png') repeat-x" />
</td>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/footer_right.png')" />
</td>
</tr>
</table>

<table width="99%" align="center">
<tr align="center">
<td width="33%">
<small><i><a href="http://sourceforge.net/projects/cgru/"><img src="../../doc/images/sourceforgeproject.png" border="0" alt="SourceForge.net Project" /></a></i></small>
</td>
<td width="33%">
<p><a href="../../index.html" target="_top"><img src="../../doc/images/cgru16.png" border="0" alt="CGRU" /></a></p>
</td>
<td width="33%">
<small><i><a href="http://www.cgtalk.ru/forum/forumdisplay.php?f=168"><img src="../../doc/images/cgtalkforum.png" border="0" alt="cgtalkforum" /></a></i></small>
</td>
</tr>
</table>
</body>
</html>
