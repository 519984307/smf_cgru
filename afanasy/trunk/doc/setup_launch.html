<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<link href="../../doc/styles.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="images/icon.png" type="image/png">
<title>Afanasy Setup</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="Timur Hairulin" />
<meta name="description" content="CGRU: CG Tools, Afanasy - Free Open Source Render Farm Manager" />
<meta name="keywords" content="Houdini, Maya, Nuke, RenderMan, Mantra, Mentalray, Max, XSI, SoftImage, prman, Afanasy, animation, rendering, render, farm, manager, free, open source, 3D, 2D" />
</head>
<body>
<table width="99%" align="center">
<tr align="center">
<td width="33%">
<a href="http://sourceforge.net"><img src="../../doc/images/sflogo.png" width="88" height="31" border="0" alt="SourceForge.net Logo" /></a>
</td>
<td width="33%">
<p><a href="../../index.html" target="_top"><img src="../../doc/images/cgru16.png" border="0" alt="CGRU" /></a></p>
</td>
<td width="33%">
<a href="http://cgtalk.ru"><img src="../../doc/images/cgtalkru.png" width="88" height="31" border="0" alt="CGTALK.RU Logo" /></a>
</td>
</tr>
</table>

<table width="100%" align="center" cellpadding="0" cellspacing="0">
<tr>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/header_left.png')" />
</td>
<td>
<div style="width:100%;height:40px;background:url('../../doc/images/header.png') repeat-x" />
</td>
<td width="200px">
<div style="width:100%;height:40px;background:url('../../doc/images/header_right.png')" />
</td>
</tr>
</table>
<table width="90%" border="0" align="center" cellpadding="0" cellspacing="0"><tr><td>
<!--HEADER-->
<h2 align="center">Afanasy Setup &amp; Launch</h2>
<hr />

<p>
   If you have used Linux packages (<i>rpm</i> or <i>deb</i>)
   you already have <code>afrender</code> (and <code>afserver</code> if you have installed it)
   running automatically at system startup.
   They run from <kbd>renderer</kbd> user by default, which was created during install.
</p>
<p>
   Afanasy binaries located in <kbd>.../cgru/afanasy/bin</kbd> directory.
   To work properly they need some environment setup.
   There are some example scripts to setup environment and launch Afanasy application.
</p>
<p>
   Go in <kbd>.../cgru/examples/scripts</kbd> folder.<br/>
   <code>afrender.sh</code> - Run render. For MS Windows - <code>afrender.cmd</code>.<br/>
   <code>afwatch.sh</code> - Run GUI. For MS Windows - <code>afwatch.cmd</code>.<br/>
   </p>
<p>
   This scripts setup CGRU and Afanasy environment and run application.
   Next documentation shows what you need to do to setup, launch, customize and automatically start Afanasy applications.
</p>

<ol>
<li><h4>Setup Environment</h4>
   <p>
   You need to setup CGRU and Afanasy environment.
   There are scripts to setup it.
   They based on a working directory.
   To setup CGRU you need to go to CGRU root folder and source setup scripts.
   Afanasy setup is the same.
   </p>
   <ul>
      <li>
         Setup CGRU:<br />
         <code>$ cd .../cgru</code><br />
         <code>$ source setup.sh</code><br/>
         (On MS Windows <code>call setup.cmd</code>)<br/>
      </li>
      <li>
         Setup Afanasy:<br />
         <code>$ cd .../cgru/afanasy/[trunk|branch|tag]</code><br />
         <code>$ source setup.sh</code><br/>
         (On MS Windows <code>call setup.cmd</code>)<br/>
      </li>
   </ul>
   <p>
   Setup puts <kbd>.../cgru/bin</kbd> and <kbd>.../cgru/afanasy/bin</kbd> in <code>PATH</code>.<br/>
   Appends <code>PYTHONPATH</code> with <kbd>.../cgru/bin</kbd>, <kbd>.../cgru/afanasy/python</kbd> and <kbd>.../cgru/afanasy/bin</kbd>.
   It allows to import CGRU and Afanasy Python modules.
   </p>
   <ul>
   <li>Unix:<br/>
      <p>
      To check Environment you can launch <kbd>afcmd</kbd> command.
      If the program is exists and its output produced no errors, the environment is OK.<br/>
      </p>
      <p>
      To automate terminals setup you can put next line at the end of your <kbd>~/.bashrc</kbd> file:<br/>
      <code>pwd=$PWD; cd .../cgru; source setup.sh; cd afanasy; source setup.sh; cd $pwd</code><br/>
      </p>
   </li>
   <li>MS Windows:<br/>
      You can do the same to setup command line.
   </li>
   </ul>
</li>
<li><h4>Launch</h4>
   <p>
      After setup you can simply run a command <code>afrender</code> or <code>afwatch</code>,
      as Afanasy binaries are in PATH.
   </p>
   <p>
      You can run Python and import Afanasy module to construct and send jobs.<br/>
      <code>import af</code>
   </p>
</li>
<li><h4>Automatic startup</h4>
   <ul>
   <li><h4>MS Windows</h4>
      <p>
         To start render at computer boot, you can simple make a link to start script in a "Startup" menu.
      </p>
      <p>
         There are no afanasy services written yet.
         But it should not be a problem for administrator
         to make a script to run render automatically from any user and with no GUI.
         And it is very useful to setup Watch render custom commands to stop and start render by such scripts
         (See <code>rendercmds</code> on <a href="watch_config.html">watch configuration page</a>).
      </p>
   </li>
   <li><h4>Linux</h4>
      <p>
         There is some ready solution (<i>bash</i> scripts) to make server and render to launch automatically at system boot.
      </p>         
      <p>
         It is better to launch server and render processes by a special user. Lets name him <kbd>renderer</kbd>.
      </p>
      <code># useradd renderer</code><br/>
      <p>
         This command will create him. Next scripts use this user name.
      </p>
      <p>
         There are some <kbd>bash</kbd> scripts in <code>cgru/afanasy/init</code> directory.
         They can help you to setup automatic server and render launch.
         You can manually link <kbd>afserver</kbd> or <kbd>afrender</kbd> script in your startup scripts location
         or use <kbd>initlink.sh</kbd> utility to do it.
      </p>
         <code># ./initlinks.sh [options] afserver</code><br/>
         <code># ./initlinks.sh [options] afrender</code><br/>
      <p>
         You can launch this script with no arguments to output help.
      </p>
      <p>
         This command creates a link in <kbd>/etc/init.d</kbd> directory to a Afanasy application.
         Puts links in <kbd>/etc/rc?.d</kbd> directories to provide service starting and stopping.
         See script file for details.
      </p>
      <p>
         After this afanasy services will start on machine boot and stop on shutdown automatically. Or you can start and stop them manually  by following commands:
      </p>
      <code># /etc/init.d/afserver start</code><br/>
      <code># /etc/init.d/afserver stop</code><br/>
      <code># /etc/init.d/afrender start</code><br/>
      <code># /etc/init.d/afrender stop</code><br/>
      <p>
         If you starting scripts as <kbd>root</kbd> user, applications will be launched by <kbd>renderer</kbd> user.
         You can customize 'non root' username in <kbd>cgru/afanasy/nonrootuser</kbd> file.
      </p>
      <p>
         This starting scripts also provide log rotating. Logs and pid files are stored in <kbd>/var/tmp/afanasy</kbd> directory.
      </p>
   </li>
   <li><h4>Other UNIX-es and MAC</h4>
      <p>
         You should know how to make something to launch automatically if you enough brave to setup a render farm on such systems.
      </p>
   </li>
   </ul>
</li>
</ol>
<!--FOOTER-->
</td></tr></table>
<table width="100%" align="center" cellpadding="0" cellspacing="0">
<tr>
<td width="200px">
   <div style="width:100%;height:40px;background:url('../../doc/images/footer_left.png')" />
</td>
<td>
   <div style="width:100%;height:40px;background:url('../../doc/images/footer.png') repeat-x" />
</td>
<td width="200px">
   <div style="width:100%;height:40px;background:url('../../doc/images/footer_center.png')" />
</td>
<td>
   <div style="width:100%;height:40px;background:url('../../doc/images/footer.png') repeat-x" />
</td>
<td width="200px">
   <div style="width:100%;height:40px;background:url('../../doc/images/footer_right.png')" />
</td>
</tr>
</table>

<table width="99%" align="center">
<tr align="center">
<td width="33%">
<small><i><a href="http://sourceforge.net/projects/cgru/"><img src="../../doc/images/sourceforgeproject.png" border="0" alt="SourceForge.net Project" /></a></i></small>
</td>
<td width="33%">
<p><a href="../../index.html" target="_top"><img src="../../doc/images/cgru16.png" border="0" alt="CGRU" /></a></p>
</td>
<td width="33%">
<small><i><a href="http://www.cgtalk.ru/forum/forumdisplay.php?f=168"><img src="../../doc/images/cgtalkforum.png" border="0" alt="cgtalkforum" /></a></i></small>
</td>
</tr>
</table>
</body>
</html>
